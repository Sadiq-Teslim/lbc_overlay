<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>LBC â€¢ Countdown Challenge</title>
<style>
:root{
  --bg:#0d0f12; --panel:#1a1f27; --panel2:#20242b;
  --text:#e9edf2; --muted:#a7b0bc;
  --gold1:#f8e49c; --gold2:#f1c74a; --gold3:#b98a28;
  --success:#39d98a; --danger:#ff6b6b; --focus:#7ec8ff;
  --shadow:0 10px 24px rgba(0,0,0,.45);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--text);
  background:
    radial-gradient(1200px 700px at 20% -10%, rgba(241,199,74,.20), transparent 42%),
    radial-gradient(1600px 900px at 120% 120%, rgba(185,138,40,.14), transparent 42%),
    var(--bg);
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, Noto Sans, "Apple Color Emoji","Segoe UI Emoji";
  letter-spacing:.2px;
}
.wrap{padding:clamp(12px,2vw,22px)}
.panel{
  width:min(1080px,94vw); margin:auto; overflow:hidden; position:relative;
  background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
  border-radius:16px; box-shadow:var(--shadow);
  border:1px solid rgba(241,199,74,.35);
}
.header,.footer{
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  padding:12px clamp(12px,2vw,20px);
  background:linear-gradient(180deg,rgba(0,0,0,.28),rgba(0,0,0,.12));
  border-bottom:1px solid rgba(255,255,255,.10);
}
.footer{border-top:1px solid rgba(255,255,255,.10); border-bottom:none}
.h1{
  margin:0; font-size:clamp(20px,3vw,34px); letter-spacing:.6px; text-transform:uppercase;
  background:linear-gradient(90deg,var(--gold1),var(--gold2),var(--gold3));
  -webkit-background-clip:text; background-clip:text; color:transparent;
  filter:drop-shadow(0 2px 8px rgba(241,199,74,.18))
}
.header__left{display:flex; align-items:center; gap:12px; flex-wrap:wrap}
.live-pill{
  display:inline-flex; align-items:center; gap:8px;
  font-weight:800; font-size:12px; padding:6px 10px; border-radius:999px;
  background:rgba(57,217,138,.1); color:var(--success); border:1px solid rgba(57,217,138,.5)
}
.dot{width:10px;height:10px;border-radius:50%; background:var(--success);
  box-shadow:0 0 0 0 rgba(57,217,138,.7); animation:pulse 2s infinite}
@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(57,217,138,.7)}70%{box-shadow:0 0 0 12px rgba(57,217,138,0)}100%{box-shadow:0 0 0 0 rgba(57,217,138,0)}}
.model{font-weight:800; color:var(--gold1)}
.lang-toggle{display:flex; gap:6px}
.lang-toggle button{
  border:1px solid rgba(241,199,74,.45); background:rgba(241,199,74,.12); color:var(--gold1);
  padding:6px 10px; border-radius:999px; font-size:12px; font-weight:800; cursor:pointer;
}
.lang-toggle button:focus-visible{
  outline:2px solid transparent;
  box-shadow:0 0 0 3px var(--focus), 0 0 14px rgba(126,200,255,.45);
  border-color:var(--focus);
}
.lang-toggle button[aria-pressed="true"]{
  background:linear-gradient(180deg,var(--gold2),var(--gold3)); color:#111; border-color:rgba(0,0,0,.2)
}

.content{display:grid; grid-template-columns:1.3fr .7fr; gap:14px; padding:12px clamp(12px,2vw,20px)}
.block{
  background:linear-gradient(180deg,var(--panel),var(--panel2));
  border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:14px
}
.block h2{margin:0 0 10px; font-size:16px; color:var(--gold1); letter-spacing:.4px}
.timer{display:grid; gap:10px; text-align:center}
.clock{font-size:clamp(34px,8vw,66px); font-weight:900; letter-spacing:.04em}
.timerbar{height:14px; border-radius:999px; background:rgba(255,255,255,.12); overflow:hidden}
.timerbar__fill{height:100%; width:100%; background:linear-gradient(90deg,#ff9a9a,var(--gold2),var(--success)); transition:width .5s linear}

.goal{
  display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center;
  padding:10px; border-radius:12px; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.10)
}
.goal .meter{height:12px; border-radius:999px; background:rgba(255,255,255,.10); overflow:hidden}
.goal .meter__fill{height:100%; width:0%; background:linear-gradient(90deg,var(--gold3),var(--gold2),var(--gold1)); transition:width .6s cubic-bezier(.2,.8,.2,1)}
.small{font-size:12px; color:var(--muted)}

.kpis{display:grid; grid-template-columns:repeat(3,1fr); gap:10px}
.kpi{background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.10); border-radius:10px; padding:10px; text-align:center}
.kpi .val{font-weight:900; font-variant-numeric:tabular-nums; margin-top:4px}

.rightcol{display:grid; grid-template-rows:auto auto; gap:12px}
.list{list-style:none; margin:8px 0 0; padding:0; display:flex; flex-direction:column; gap:8px}
.list li{
  display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center;
  padding:8px 10px; border-radius:10px; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.10);
  transition:box-shadow .3s, border-color .3s;
}
.badge{font-size:10px; font-weight:900; letter-spacing:.3px; padding:3px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.24); color:#111; background:linear-gradient(180deg,#fff,#d7d7d7)}
.badge--whale{background:linear-gradient(180deg,#ffe2cc,#ffc199); color:#5b2b00; border-color:#ffb37e}

/* Highlights */
.recent-current{box-shadow:0 0 0 2px rgba(126,200,255,.6), 0 0 16px rgba(126,200,255,.35)}
.leader-top{box-shadow:0 0 0 2px rgba(241,199,74,.6), 0 0 18px rgba(241,199,74,.35); border-color:rgba(241,199,74,.55)!important}

.sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
.footer .note{font-size:12px; color:var(--muted)}

@media (max-width:900px){ .content{grid-template-columns:1fr} .kpis{grid-template-columns:1fr 1fr} }
@media (max-width:560px){ .kpis{grid-template-columns:1fr} .list li{grid-template-columns:1fr auto} }
@media (prefers-reduced-motion:reduce){ .timerbar__fill,.goal .meter__fill{transition:none} .dot{animation:none; box-shadow:none} }
</style>
</head>
<body>
<div class="wrap">
  <section class="panel" aria-label="Countdown Overlay">
    <div id="sr-announce" class="sr-only" aria-live="assertive" aria-atomic="true"></div>
    <header class="header">
      <div class="header__left">
        <h1 class="h1" id="hdr">ðŸ”¥ Countdown Challenge</h1>
        <span class="live-pill"><span class="dot" aria-hidden="true"></span><span id="liveTxt">Live Show: Active</span></span>
        <span class="model" id="modelName">Model: Carmen Ruiz</span>
        <span class="small" id="roundInfo" style="margin-left:8px;opacity:.8">Round 1/4</span>
      </div>
      <div class="lang-toggle" role="group" aria-label="Language">
        <button data-lang="en" aria-pressed="true">ENG</button>
        <button data-lang="es" aria-pressed="false">ESP</button>
        <button data-lang="fr" aria-pressed="false">FRA</button>
      </div>
    </header>
    <div class="content">
      <section class="block">
        <h2 id="titleLine">Tip $150 before time ends to unlock the surprise show!</h2>
        <div class="timer" aria-live="polite" aria-atomic="true">
          <div class="clock" id="clock">03:00</div>
          <div class="timerbar" aria-hidden="true"><div id="timeFill" class="timerbar__fill"></div></div>
        </div>
        <div class="goal" style="margin-top:12px">
          <div>
            <div class="small" id="goalLabel">Progress</div>
            <div class="meter"><div id="goalFill" class="meter__fill"></div></div>
            <div class="small" id="goalNums">$0 of $150</div>
          </div>
          <div class="kpis">
            <div class="kpi">
              <div class="small" id="kTopFanLbl">Top Fan</div><div class="val" id="kTopFan">â€”</div>
            </div>
            <div class="kpi">
              <div class="small" id="kContribLbl">Contributors</div><div class="val" id="kContribs">0</div>
            </div>
            <div class="kpi">
              <div class="small" id="kAvgLbl">Avg Tip</div><div class="val" id="kAvg">$0</div>
            </div>
          </div>
        </section>
      <aside class="rightcol">
        <section class="block" aria-labelledby="recentHdr">
          <h2 id="recentHdr">Recent Tips (last 5)</h2><ol class="list" id="recentList"></ol>
        </section>
        <section class="block" aria-labelledby="leaderHdr">
          <h2 id="leaderHdr">Leaderboard</h2><ol class="list" id="leaderList"></ol>
        </section>
      </aside>
    </div>
    <footer class="footer">
      <div class="note" id="footNote">Source: URL params (demo). Use ws/json in production.</div>
      <div class="note">Status: <strong id="statusStrong">Live</strong></div>
    </footer>
    <canvas id="confetti" style="position:absolute; inset:0; pointer-events:none;"></canvas>
  </section>
</div>
<script>
const p = new URLSearchParams(location.search);
const BASE_DURATION = parseInt(p.get('duration')||'180',10);
const GOAL = parseFloat(p.get('goal')||'150');
const CURRENCY = p.get('currency') || 'USD';
const WS_URL = p.get('ws') || null;

const I18N = {
  en:{ header:'ðŸ”¥ Countdown Challenge', live:'Live Show: Active', model:'Model: Carmen Ruiz',
       title:`Tip ${money(GOAL,CURRENCY)} before time ends to unlock the surprise show!`,
       goalLabel:'Progress', recent:'Recent Tips (last 5)', leaders:'Leaderboard',
       kTopFan:'Top Fan', kContribs:'Contributors', kAvg:'Avg Tip',
       foot:'Source: URL params (demo). Use ws/json in production.', round:'Round', goalReached:'Goal reached! Show unlocked.' },
  es:{ header:'ðŸ”¥ DesafÃ­o con Cuenta Regresiva', live:'Show en Vivo: Activo', model:'Modelo: Carmen Ruiz',
       title:`Â¡Dona ${money(GOAL,CURRENCY)} antes de que termine el tiempo para desbloquear el show!`,
       goalLabel:'Progreso', recent:'Propinas Recientes (Ãºltimas 5)', leaders:'Tabla de ClasificaciÃ³n',
       kTopFan:'Mejor Fan', kContribs:'Contribuyentes', kAvg:'Propina Prom.',
       foot:'Fuente: parÃ¡metros de URL (demo). Usa ws/json en producciÃ³n.', round:'Ronda', goalReached:'Â¡Meta alcanzada! Show desbloqueado.' },
  fr:{ header:'ðŸ”¥ DÃ©fi Ã  Compte Ã  Rebours', live:'Show en Direct : Actif', model:'ModÃ¨le : Carmen Ruiz',
       title:`Contribuez ${money(GOAL,CURRENCY)} avant la fin pour dÃ©bloquer le show !`,
       goalLabel:'Progression', recent:'Pourboires RÃ©cents (5 derniers)', leaders:'Classement',
       kTopFan:'Fan NÂ°1', kContribs:'Contributeurs', kAvg:'Pourboire Moy.',
       foot:'Source : paramÃ¨tres dâ€™URL (dÃ©mo). Utiliser ws/json en prod.', round:'Manche', goalReached:'Objectif atteint ! Show dÃ©bloquÃ©.' }
};

let lang='en';
const langBtns=document.querySelectorAll('.lang-toggle button');
langBtns.forEach(b=>b.addEventListener('click',()=>setLang(b.dataset.lang,true)));
let langIdx=0; const langCycle=['en','es','fr'];
setInterval(()=>{ if(document.hidden) return; langIdx=(langIdx+1)%langCycle.length; setLang(langCycle[langIdx], false); }, 15000);
function setLang(code, userAction){
  lang = ['en','es','fr'].includes(code)?code:'en';
  langBtns.forEach(b=>b.setAttribute('aria-pressed', String(b.dataset.lang===lang)));
  const t=I18N[lang];
  document.title='LBC â€¢ '+t.header; T('hdr',t.header); T('liveTxt',t.live); T('modelName',t.model);
  T('titleLine',t.title); T('goalLabel',t.goalLabel); T('recentHdr',t.recent); T('leaderHdr',t.leaders);
  T('kTopFanLbl',t.kTopFan); T('kContribLbl',t.kContribs); T('kAvgLbl',t.kAvg); T('footNote',t.foot);
  updateRoundLabel(); if(userAction) langIdx = langCycle.indexOf(lang);
}
let round = 1; const maxResets = 3;
let startTs = Date.now(); let endTs = startTs + BASE_DURATION*1000;
let total=0; const contributors=new Map(); let recent=[];
function resetRound(){ round++; startTs = Date.now(); endTs = startTs + BASE_DURATION*1000; updateRoundLabel(true); requestAnimationFrame(tick); }
function updateRoundLabel(announceIt=false){ const t = I18N[lang]; const txt = `${t.round} ${round}/${1+maxResets}`; T('roundInfo', txt); if(announceIt) announce(txt); }
function announce(msg){ const el = gid('sr-announce'); el.textContent=''; setTimeout(()=>{ el.textContent = msg; }, 20); }
requestAnimationFrame(tick);
function tick(){
  const now=Date.now(); const remain=Math.max(0,Math.floor((endTs-now)/1000));
  T('clock',fmt(remain)); const dur=endTs-startTs; const passed=Math.max(0,Math.min(1,(now-startTs)/dur));
  gid('timeFill').style.width=Math.round((1-passed)*100)+'%';
  if(remain<=0){ if(total >= GOAL){ fireConfetti(); announce(I18N[lang].goalReached); return; } if(round <= maxResets){ resetRound(); return; } return; }
  requestAnimationFrame(tick);
}
let needsRender=false;
function scheduleRender(){ if(!needsRender){ needsRender=true; requestAnimationFrame(()=>{ needsRender=false; render(); }); } }
function tip(name,amount){ if(!(amount>0))return; total+=amount; contributors.set(name,(contributors.get(name)||0)+amount); recent.push({name,amount,t:Date.now()}); if(recent.length>50) recent=recent.slice(-50); scheduleRender(); }
function refund(name,amount){ if(!(amount>0))return; total=Math.max(0,total-amount); contributors.set(name,Math.max(0,(contributors.get(name)||0)-amount)); recent.push({name,amount:-amount,t:Date.now()}); if(recent.length>50) recent=recent.slice(-50); scheduleRender(); }
if(WS_URL){
  try{
    const ws = new WebSocket(WS);
    ws.onmessage = (evt)=>{ try{ const msg = JSON.parse(evt.data); if(msg.type==='tip'){ tip(msg.user?.name||'User', +msg.amount||0); } else if(msg.type==='refund'){ refund(msg.user?.name||'User', +msg.amount||0); } }catch{} };
  }catch{}
}
[['SirGold',20],['FireHeat',40],['Loverboy777',12]].forEach(([n,a],i)=>setTimeout(()=>{tip(n,a)},500+i*500));
setInterval(()=>{ const who=['VIP_21','RedAlert','Nova','Sky','CarmenFan'][Math.floor(Math.random()*5)]; const amt=[5,10,15,25,40,60][Math.floor(Math.random()*6)]; tip(who,amt); }, 5000);
function render(){
  const pct=Math.max(0,Math.min(100,Math.round((total/GOAL)*100)));
  gid('goalFill').style.width=pct+'%'; T('goalNums', `${money(total)} of ${money(GOAL)}`);
  const arr=[...contributors.entries()].map(([name,amt])=>({name,amt})).sort((a,b)=>b.amt-a.amt);
  T('kTopFan', arr[0]?.name || 'â€”'); T('kContribs', String(arr.length));
  const tipsCount = recent.length; T('kAvg', tipsCount ? money(Math.round(total/tipsCount)) : money(0));
  const r=gid('recentList'); r.innerHTML=''; const last5 = recent.slice(-5).reverse();
  last5.forEach((x,i)=>{ const li=document.createElement('li'); const left=document.createElement('div'); left.textContent=x.name; const right=document.createElement('div'); right.textContent=(x.amount>=0?'+':'âˆ’')+money(Math.abs(x.amount)); if(x.amount>=200) right.className='badge badge--whale'; if(i===0) li.classList.add('recent-current'); li.appendChild(left); li.appendChild(right); r.appendChild(li); });
  const l=gid('leaderList'); l.innerHTML='';
  arr.slice(0,5).forEach((x,i)=>{ const li=document.createElement('li'); const left=document.createElement('div'); left.textContent=`${i+1}. ${x.name}`; const right=document.createElement('div'); right.textContent=money(x.amt); if(i===0) li.classList.add('leader-top'); li.appendChild(left); li.appendChild(right); l.appendChild(li); });
}
function T(id, txt){ gid(id).textContent = txt }
function gid(id){ return document.getElementById(id) }
function money(v,cur=CURRENCY){ try{ return new Intl.NumberFormat(undefined,{style:'currency',currency:cur,maximumFractionDigits:0}).format(v);}catch{ return '$'+Math.round(v);} }
function fmt(sec){ const m=Math.floor(sec/60), s=sec%60; return String(m).padStart(2,'0')+':'+String(s).padStart(2,'0') }
function fireConfetti(){
  const c = document.getElementById('confetti'); const ctx = c.getContext('2d'); const dpr = Math.max(1, window.devicePixelRatio||1);
  const resize=()=>{ c.width = c.clientWidth*dpr; c.height = c.clientHeight*dpr; }; resize(); window.addEventListener('resize', resize, {once:true});
  const parts = Array.from({length:180}, (_,i)=>({ x: Math.random()*c.width, y: -Math.random()*c.height*0.5, r: 3+Math.random()*4, vx: -1+Math.random()*2, vy: 2+Math.random()*3, a: Math.random()*Math.PI*2, s: 0.04+Math.random()*0.06, col: `hsl(${Math.random()*360},90%,60%)`, life: 120+Math.random()*60 }));
  let frame=0;
  (function loop(){ frame++; ctx.clearRect(0,0,c.width,c.height); parts.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; p.a+=p.s; p.vy+=0.02; p.life-=1; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.a); ctx.fillStyle=p.col; ctx.fillRect(-p.r,-p.r,p.r*2,p.r*2); ctx.restore(); }); if(frame<240) requestAnimationFrame(loop); else ctx.clearRect(0,0,c.width,c.height); })();
}
render(); setLang('en', true);
window.addEventListener('message', (event) => {
    if (event.data && event.data.type === 'countdown.tip') {
        tip(event.data.data.name, event.data.data.amount);
    }
    if (event.data && event.data.type === 'latency_ping') {
        window.parent.postMessage({ type: 'latency_pong', start: event.data.start }, '*');
    }
});
</script>
</body>
</html>